#!/bin/bash

[ -z $* ] && echo "${0##*/} [domain_name].[TLD]"

domain=$(echo $1 | sed -E "s!^http[s]?://!!g")
url="https://$domain"
user_agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36"

crawl() {

        base_url="https://$(echo "$1" | cut -d '/' -f 3)"

        curl -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \
             -H 'Accept-Language: en-GB,en-US;q=0.8,en;q=0.6' -A "$user_agent" -sL "$1" | \
             grep -Eo "href=[\"'][^\"']+"  | sed -E "s@href=[\"'](#.*|/)?(.*)@\2@g" | \
             sed -E -e "s^[[:space:]]^%20^g" -e "/^(http|tel)/!s!.*!$base_url\/&!"

}

cache=($(crawl "$url"))

for obj in "${cache[@]}"; do

        echo -e "\e[1;31m$obj\e[0m"
        [[ "$obj" =~ .*$domain[/]?$ ]] && continue
        [[ "$obj" =~ ^http.* ]] && crawl "$obj"
done
